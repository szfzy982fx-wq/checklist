<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profesyonel Emlak YÃ¶neticisi v2.0</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', sans-serif; }
        .nav-pills .nav-link.active { background-color: #0d6efd; }
        .card { border: none; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-radius: 10px; }
        #map { height: 300px; width: 100%; border-radius: 8px; }
        .preview-img { max-width: 100%; max-height: 200px; border-radius: 8px; border: 2px solid #ddd; display: none; margin-top: 10px; }
        .feature-group-title { font-weight: bold; color: #555; border-bottom: 2px solid #eee; padding-bottom: 5px; margin-bottom: 10px; margin-top: 20px; }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-primary">ğŸ  Emlak PortfÃ¶y YÃ¶neticisi</h2>
        <div>
            <button class="btn btn-outline-success btn-sm" onclick="exportData()">ğŸ’¾ Yedek Al</button>
            <input type="file" id="importFile" style="display:none" onchange="importData(this)">
            <button class="btn btn-outline-warning btn-sm" onclick="document.getElementById('importFile').click()">ğŸ“‚ Yedek YÃ¼kle</button>
        </div>
    </div>

    <ul class="nav nav-pills mb-3 nav-justified" id="mainTab" role="tablist">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#tab-identity">1. Ä°lan KimliÄŸi</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-tech">2. Teknik Detay</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-loc" onclick="resizeMap()">3. Konum</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-features">4. Ã–zellikler</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-media">5. Medya</button></li>
        <li class="nav-item"><button class="nav-link bg-dark text-white" data-bs-toggle="pill" data-bs-target="#tab-list" onclick="loadList()">ğŸ“‹ Checklist & Liste</button></li>
    </ul>

    <div class="tab-content">
        
        <div class="tab-pane fade show active" id="tab-identity">
            <form id="emlakForm">
                <input type="hidden" id="recordId">
                <div class="card p-4">
                    <div class="row g-3">
                        <div class="col-12">
                            <label class="form-label fw-bold">Ä°lan BaÅŸlÄ±ÄŸÄ±</label>
                            <input type="text" class="form-control" id="title" placeholder="Ã–rn: Denize SÄ±fÄ±r LÃ¼ks Daire" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label">AÃ§Ä±klama</label>
                            <textarea class="form-control" id="desc" rows="3"></textarea>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Fiyat</label>
                            <input type="number" class="form-control" id="price">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Birim</label>
                            <select class="form-select" id="currency">
                                <option value="TL">â‚º TL</option>
                                <option value="USD">$ USD</option>
                                <option value="EUR">â‚¬ EUR</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Ä°lan TÃ¼rÃ¼</label>
                            <select class="form-select" id="adType">
                                <option>SatÄ±lÄ±k</option>
                                <option>KiralÄ±k</option>
                                <option>Devren</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Konut Tipi</label>
                            <select class="form-select" id="propType">
                                <option>Daire</option>
                                <option>Villa</option>
                                <option>Rezidans</option>
                                <option>MÃ¼stakil Ev</option>
                                <option>YazlÄ±k</option>
                                <option>Arsa</option>
                                <option>Ä°ÅŸyeri</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

        <div class="tab-pane fade" id="tab-tech">
            <div class="card p-4">
                <div class="row g-3">
                    <div class="col-md-3"><label>BrÃ¼t mÂ²</label><input type="number" class="form-control" id="grossM2"></div>
                    <div class="col-md-3"><label>Net mÂ²</label><input type="number" class="form-control" id="netM2"></div>
                    <div class="col-md-3">
                        <label>Oda SayÄ±sÄ±</label>
                        <select class="form-select" id="rooms">
                            <option>1+1</option><option>2+1</option><option>3+1</option><option>4+1</option><option>5+1</option><option>StÃ¼dyo</option>
                        </select>
                    </div>
                    <div class="col-md-3"><label>Bina YaÅŸÄ±</label>
                        <select class="form-select" id="age">
                            <option>0 (Yeni)</option><option>1-5</option><option>5-10</option><option>11-20</option><option>21+</option>
                        </select>
                    </div>
                    
                    <div class="col-md-3"><label>BulunduÄŸu Kat</label><input type="text" class="form-control" id="floorCurr"></div>
                    <div class="col-md-3"><label>Kat SayÄ±sÄ±</label><input type="number" class="form-control" id="floorTotal"></div>
                    <div class="col-md-3"><label>Banyo SayÄ±sÄ±</label><input type="number" class="form-control" id="bath" value="1"></div>
                    <div class="col-md-3"><label>IsÄ±tma</label>
                        <select class="form-select" id="heating">
                            <option>Klima</option><option>Kombi (D.Gaz)</option><option>Merkezi</option><option>Yerden IsÄ±tma</option><option>Soba</option><option>Yok</option>
                        </select>
                    </div>

                    <div class="col-md-3"><label>Aidat (TL)</label><input type="number" class="form-control" id="dues"></div>
                    <div class="col-md-3"><label>Krediye Uygun?</label>
                        <select class="form-select" id="credit"><option>Evet</option><option>HayÄ±r</option></select>
                    </div>
                    <div class="col-md-3"><label>Takas?</label>
                        <select class="form-select" id="swap"><option>HayÄ±r</option><option>Evet</option></select>
                    </div>
                    <div class="col-md-3"><label>EÅŸyalÄ±?</label>
                        <select class="form-select" id="furnished"><option>HayÄ±r</option><option>Evet</option></select>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="tab-loc">
            <div class="card p-4">
                <div class="d-flex justify-content-between mb-3">
                    <h5>Konum Bilgileri</h5>
                    <button type="button" class="btn btn-primary btn-sm" onclick="getLocation()">ğŸ“ Konumumu Bul</button>
                </div>
                <div class="row g-2">
                    <div class="col-md-4"><input type="text" class="form-control" id="city" placeholder="Ä°l"></div>
                    <div class="col-md-4"><input type="text" class="form-control" id="district" placeholder="Ä°lÃ§e"></div>
                    <div class="col-md-4"><input type="text" class="form-control" id="neighborhood" placeholder="Mahalle"></div>
                    <div class="col-12"><div id="map"></div></div>
                    <input type="hidden" id="lat"><input type="hidden" id="lng">
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="tab-features">
            <div class="card p-4">
                
                <h6 class="feature-group-title">ğŸ§­ Cephe SeÃ§imi</h6>
                <div class="btn-group" role="group">
                    <input type="checkbox" class="btn-check facade-check" id="f_kuzey" value="Kuzey" autocomplete="off"><label class="btn btn-outline-secondary" for="f_kuzey">Kuzey</label>
                    <input type="checkbox" class="btn-check facade-check" id="f_guney" value="GÃ¼ney" autocomplete="off"><label class="btn btn-outline-secondary" for="f_guney">GÃ¼ney</label>
                    <input type="checkbox" class="btn-check facade-check" id="f_dogu" value="DoÄŸu" autocomplete="off"><label class="btn btn-outline-secondary" for="f_dogu">DoÄŸu</label>
                    <input type="checkbox" class="btn-check facade-check" id="f_bati" value="BatÄ±" autocomplete="off"><label class="btn btn-outline-secondary" for="f_bati">BatÄ±</label>
                </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <h6 class="feature-group-title">ğŸ  Ä°Ã§ Ã–zellikler</h6>
                        <div class="form-check"><input class="form-check-input feat-in" type="checkbox" value="Ã‡elik KapÄ±"><label>Ã‡elik KapÄ±</label></div>
                        <div class="form-check"><input class="form-check-input feat-in" type="checkbox" value="DuÅŸakabin"><label>DuÅŸakabin</label></div>
                        <div class="form-check"><input class="form-check-input feat-in" type="checkbox" value="Ebeveyn Banyosu"><label>Ebeveyn Banyosu</label></div>
                        <div class="form-check"><input class="form-check-input feat-in" type="checkbox" value="Ankastre Set"><label>Ankastre Set</label></div>
                        <div class="form-check"><input class="form-check-input feat-in" type="checkbox" value="Klima"><label>Klima</label></div>
                    </div>
                    <div class="col-md-4">
                        <h6 class="feature-group-title">ğŸ¢ DÄ±ÅŸ & Site</h6>
                        <div class="form-check"><input class="form-check-input feat-out" type="checkbox" value="AsansÃ¶r"><label>AsansÃ¶r</label></div>
                        <div class="form-check"><input class="form-check-input feat-out" type="checkbox" value="Otopark"><label>Otopark</label></div>
                        <div class="form-check"><input class="form-check-input feat-out" type="checkbox" value="GÃ¼venlik"><label>GÃ¼venlik</label></div>
                        <div class="form-check"><input class="form-check-input feat-out" type="checkbox" value="Havuz"><label>Havuz</label></div>
                        <div class="form-check"><input class="form-check-input feat-out" type="checkbox" value="JeneratÃ¶r"><label>JeneratÃ¶r</label></div>
                    </div>
                    <div class="col-md-4">
                        <h6 class="feature-group-title">ğŸ“ Muhit & UlaÅŸÄ±m</h6>
                        <div class="form-check"><input class="form-check-input feat-loc" type="checkbox" value="Metroya YakÄ±n"><label>Metroya YakÄ±n</label></div>
                        <div class="form-check"><input class="form-check-input feat-loc" type="checkbox" value="OtobÃ¼s DuraÄŸÄ±"><label>OtobÃ¼s DuraÄŸÄ±</label></div>
                        <div class="form-check"><input class="form-check-input feat-loc" type="checkbox" value="Market"><label>Market / AVM</label></div>
                        <div class="form-check"><input class="form-check-input feat-loc" type="checkbox" value="Okul"><label>Okul</label></div>
                        <div class="form-check"><input class="form-check-input feat-loc" type="checkbox" value="Deniz ManzaralÄ±"><label>Deniz ManzaralÄ±</label></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="tab-media">
            <div class="card p-4 text-center">
                <h5>ğŸ“¸ Vitrin FotoÄŸrafÄ±</h5>
                <p class="text-muted small">YÃ¼klenen fotoÄŸraflar sistemin hÄ±zlÄ± Ã§alÄ±ÅŸmasÄ± iÃ§in otomatik olarak sÄ±kÄ±ÅŸtÄ±rÄ±lÄ±r (Max 800px).</p>
                <input type="file" class="form-control" id="photoInput" accept="image/*" onchange="previewPhoto()">
                <img id="photoPreview" class="preview-img mx-auto">
                <input type="hidden" id="photoBase64">
            </div>
            <div class="d-grid gap-2 mt-4">
                <button type="button" class="btn btn-success btn-lg" onclick="saveRecord()">âœ… KAYDET</button>
                <button type="button" class="btn btn-secondary" onclick="clearForm()">Temizle</button>
            </div>
        </div>
        </form>

        <div class="tab-pane fade" id="tab-list">
            <div class="card p-3">
                <h5 class="mb-3">ğŸ“‹ KayÄ±tlÄ± PortfÃ¶y Listesi</h5>
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>GÃ¶rsel</th>
                                <th>BaÅŸlÄ±k</th>
                                <th>Fiyat</th>
                                <th>Konum</th>
                                <th style="width: 180px;">Ä°ÅŸlemler</th>
                            </tr>
                        </thead>
                        <tbody id="listBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>

<div class="modal fade" id="viewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewTitle">Ä°lan DetayÄ±</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="viewBody"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // --- HARÄ°TA ---
    var map = L.map('map').setView([39.92, 32.85], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    var marker;

    function resizeMap() { setTimeout(() => { map.invalidateSize(); }, 200); }

    map.on('click', function(e) {
        setMarker(e.latlng.lat, e.latlng.lng);
        fetchAddress(e.latlng.lat, e.latlng.lng);
    });

    function setMarker(lat, lng) {
        if(marker) map.removeLayer(marker);
        marker = L.marker([lat, lng]).addTo(map);
        document.getElementById('lat').value = lat;
        document.getElementById('lng').value = lng;
    }

    function getLocation() {
        if(navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(p => {
                map.setView([p.coords.latitude, p.coords.longitude], 16);
                setMarker(p.coords.latitude, p.coords.longitude);
                fetchAddress(p.coords.latitude, p.coords.longitude);
            });
        }
    }

    async function fetchAddress(lat, lng) {
        try {
            let res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);
            let data = await res.json();
            if(data.address) {
                document.getElementById('city').value = data.address.province || data.address.city || '';
                document.getElementById('district').value = data.address.town || data.address.district || '';
                document.getElementById('neighborhood').value = data.address.suburb || data.address.neighbourhood || '';
            }
        } catch(e) {}
    }

    // --- FOTOÄRAF KÃœÃ‡ÃœLTME (Canvas Logic) ---
    function previewPhoto() {
        const file = document.getElementById('photoInput').files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            const img = new Image();
            img.onload = function() {
                // 1. Hedef BoyutlarÄ± Belirle (Max 800px)
                const maxWidth = 800;
                const maxHeight = 800;
                let width = img.width;
                let height = img.height;

                // OranÄ± koruyarak yeni boyutlarÄ± hesapla
                if (width > height) {
                    if (width > maxWidth) {
                        height *= maxWidth / width;
                        width = maxWidth;
                    }
                } else {
                    if (height > maxHeight) {
                        width *= maxHeight / height;
                        height = maxHeight;
                    }
                }

                // 2. Canvas (Tuval) OluÅŸtur ve Resmi Ã‡iz
                const canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, width, height);

                // 3. Veriyi SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ Olarak Al (JPEG, %70 Kalite)
                const compressedDataUrl = canvas.toDataURL('image/jpeg', 0.7);

                // 4. Ekranda GÃ¶ster ve HafÄ±zaya Kaydetmek Ä°Ã§in HazÄ±rla
                document.getElementById('photoPreview').src = compressedDataUrl;
                document.getElementById('photoPreview').style.display = 'block';
                document.getElementById('photoBase64').value = compressedDataUrl;
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }

    // --- VERÄ°TABANI VE CRUD ---
    function getVal(id) { return document.getElementById(id).value; }
    function setVal(id, v) { document.getElementById(id).value = v || ''; }
    function getChecks(cls) { return [...document.querySelectorAll('.'+cls+':checked')].map(c=>c.value); }

    function saveRecord() {
        const id = document.getElementById('recordId').value || 'ID'+Date.now();
        const record = {
            id,
            title: getVal('title'), desc: getVal('desc'), price: getVal('price'), currency: getVal('currency'),
            adType: getVal('adType'), propType: getVal('propType'),
            grossM2: getVal('grossM2'), netM2: getVal('netM2'), rooms: getVal('rooms'), age: getVal('age'),
            floorCurr: getVal('floorCurr'), floorTotal: getVal('floorTotal'), bath: getVal('bath'), heating: getVal('heating'),
            dues: getVal('dues'), credit: getVal('credit'), swap: getVal('swap'), furnished: getVal('furnished'),
            city: getVal('city'), district: getVal('district'), neighborhood: getVal('neighborhood'),
            lat: getVal('lat'), lng: getVal('lng'),
            facade: getChecks('facade-check'),
            featIn: getChecks('feat-in'), featOut: getChecks('feat-out'), featLoc: getChecks('feat-loc'),
            photo: document.getElementById('photoBase64').value
        };

        let db = JSON.parse(localStorage.getItem('emlakPortfoyDB')) || [];
        const idx = db.findIndex(r => r.id === id);
        if(idx > -1) db[idx] = record; else db.push(record);
        
        localStorage.setItem('emlakPortfoyDB', JSON.stringify(db));
        alert('KayÄ±t BaÅŸarÄ±lÄ±! âœ…');
        clearForm();
        loadList();
    }

    function loadList() {
        const tbody = document.getElementById('listBody');
        tbody.innerHTML = '';
        let db = JSON.parse(localStorage.getItem('emlakPortfoyDB')) || [];

        db.forEach(r => {
            let thumb = r.photo ? `<img src="${r.photo}" style="width:50px; height:40px; object-fit:cover; border-radius:4px;">` : 'ğŸ ';
            let row = `<tr>
                <td>${thumb}</td>
                <td><strong>${r.title}</strong><br><small class="text-muted">${r.adType} ${r.propType}</small></td>
                <td>${r.price} ${r.currency}</td>
                <td>${r.city}/${r.district}</td>
                <td>
                    <div class="btn-group" role="group">
                        <button class="btn btn-sm btn-info text-white" onclick="viewRecord('${r.id}')">ğŸ‘ï¸</button>
                        <button class="btn btn-sm btn-primary" onclick="editRecord('${r.id}')">âœï¸</button>
                        <button class="btn btn-sm btn-success" onclick="shareRecord('${r.id}')">ğŸ“¤</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteRecord('${r.id}')">ğŸ—‘ï¸</button>
                    </div>
                </td>
            </tr>`;
            tbody.innerHTML += row;
        });
    }

    // --- Ã–ZEL FONKSÄ°YONLAR: GÃ–RÃœNTÃœLE & PAYLAÅ ---
    function viewRecord(id) {
        let db = JSON.parse(localStorage.getItem('emlakPortfoyDB')) || [];
        let r = db.find(x => x.id === id);
        if(!r) return;

        document.getElementById('viewTitle').innerText = r.title;
        let photoHtml = r.photo ? `<img src="${r.photo}" class="img-fluid rounded mb-3" style="max-height:300px;">` : '';
        
        let html = `
            ${photoHtml}
            <div class="row">
                <div class="col-6"><strong>Fiyat:</strong> ${r.price} ${r.currency}</div>
                <div class="col-6"><strong>Tip:</strong> ${r.adType} / ${r.propType}</div>
                <div class="col-6"><strong>Oda:</strong> ${r.rooms}</div>
                <div class="col-6"><strong>mÂ² (BrÃ¼t/Net):</strong> ${r.grossM2} / ${r.netM2}</div>
                <div class="col-6"><strong>Kat:</strong> ${r.floorCurr} / ${r.floorTotal}</div>
                <div class="col-6"><strong>IsÄ±tma:</strong> ${r.heating}</div>
                <div class="col-12 mt-2"><strong>Adres:</strong> ${r.city} / ${r.district} / ${r.neighborhood}</div>
                <div class="col-12 mt-2"><div class="p-2 bg-light border rounded"><strong>Ã–zellikler:</strong><br>
                ${[...r.facade, ...r.featIn, ...r.featOut].join(', ')}</div></div>
            </div>
        `;
        document.getElementById('viewBody').innerHTML = html;
        new bootstrap.Modal(document.getElementById('viewModal')).show();
    }

    function shareRecord(id) {
        let db = JSON.parse(localStorage.getItem('emlakPortfoyDB')) || [];
        let r = db.find(x => x.id === id);
        if(!r) return;

        // WhatsApp FormatÄ±
        let text = `ğŸ  *${r.title}*\n\n` +
                   `ğŸ’° *Fiyat:* ${r.price} ${r.currency}\n` +
                   `ğŸ“ *Konum:* ${r.city} / ${r.district} / ${r.neighborhood}\n` +
                   `ğŸ“ *Bilgiler:* ${r.propType}, ${r.rooms}, ${r.grossM2}mÂ²\n` +
                   `ğŸ—ï¸ *Kat:* ${r.floorCurr}. Kat (Top: ${r.floorTotal})\n` +
                   `ğŸ”¥ *IsÄ±tma:* ${r.heating}\n\n` +
                   `âœ¨ *Ã–ne Ã‡Ä±kan Ã–zellikler:* ${r.featIn.slice(0,3).join(', ')} ${r.featOut.includes('AsansÃ¶r') ? ', AsansÃ¶r' : ''}\n\n` +
                   `ğŸ“ *Ä°letiÅŸim:* Detaylar iÃ§in arayÄ±nÄ±z!`;

        navigator.clipboard.writeText(text).then(() => {
            alert("Ä°lan bilgileri kopyalandÄ±! WhatsApp'a yapÄ±ÅŸtÄ±rabilirsin. ğŸ“‹âœ…");
        }).catch(err => {
            alert("Kopyalama baÅŸarÄ±sÄ±z oldu: " + err);
        });
    }

    function editRecord(id) {
        let db = JSON.parse(localStorage.getItem('emlakPortfoyDB')) || [];
        let r = db.find(x => x.id === id);
        if(!r) return;

        // Sekmeyi Form'a Ã‡evir
        let trigger = new bootstrap.Tab(document.querySelector('#mainTab button[data-bs-target="#tab-identity"]'));
        trigger.show();

        document.getElementById('recordId').value = r.id;
        setVal('title', r.title); setVal('desc', r.desc); setVal('price', r.price); setVal('currency', r.currency);
        setVal('adType', r.adType); setVal('propType', r.propType);
        setVal('grossM2', r.grossM2); setVal('netM2', r.netM2); setVal('rooms', r.rooms); setVal('age', r.age);
        setVal('floorCurr', r.floorCurr); setVal('floorTotal', r.floorTotal); setVal('bath', r.bath); setVal('heating', r.heating);
        setVal('dues', r.dues); setVal('credit', r.credit); setVal('swap', r.swap); setVal('furnished', r.furnished);
        setVal('city', r.city); setVal('district', r.district); setVal('neighborhood', r.neighborhood);
        setVal('lat', r.lat); setVal('lng', r.lng);

        // CheckboxlarÄ± temizle ve doldur
        document.querySelectorAll('input[type=checkbox]').forEach(c => c.checked = false);
        [...r.facade, ...r.featIn, ...r.featOut, ...r.featLoc].forEach(val => {
            let el = document.querySelector(`input[value="${val}"]`);
            if(el) el.checked = true;
        });

        // FotoÄŸraf
        if(r.photo) {
            document.getElementById('photoPreview').src = r.photo;
            document.getElementById('photoPreview').style.display = 'block';
            document.getElementById('photoBase64').value = r.photo;
        }

        if(r.lat) { setTimeout(() => { setMarker(r.lat, r.lng); map.setView([r.lat, r.lng], 15); }, 500); }
    }

    function deleteRecord(id) {
        if(confirm('Silmek istediÄŸine emin misin?')) {
            let db = JSON.parse(localStorage.getItem('emlakPortfoyDB')) || [];
            db = db.filter(x => x.id !== id);
            localStorage.setItem('emlakPortfoyDB', JSON.stringify(db));
            loadList();
        }
    }

    function clearForm() {
        document.getElementById('emlakForm').reset();
        document.getElementById('recordId').value = '';
        document.getElementById('photoPreview').style.display = 'none';
        document.getElementById('photoBase64').value = '';
        if(marker) map.removeLayer(marker);
    }
    
    // YEDEKLEME
    function exportData() {
        let data = localStorage.getItem('emlakPortfoyDB');
        let blob = new Blob([data], {type: 'application/json'});
        let a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'emlak_yedek.json';
        a.click();
    }
    function importData(input) {
        let reader = new FileReader();
        reader.onload = e => {
            localStorage.setItem('emlakPortfoyDB', JSON.stringify(JSON.parse(e.target.result)));
            loadList(); alert('YÃ¼klendi!');
        };
        reader.readAsText(input.files[0]);
    }
</script>
</body>
</html>
